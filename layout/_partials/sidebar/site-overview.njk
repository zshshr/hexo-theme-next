<div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  {%- if theme.avatar.url %}
    <img class="site-author-image" itemprop="image" alt="{{ author }}"
      src="{{ url_for(theme.avatar.url) }}">
  {%- endif %}
  <p class="site-author-name" itemprop="name">{{ author }}</p>
  <div class="site-description" itemprop="description">{{ description }}</div>
</div>

{%- if theme.site_state %}
<div class="site-state-wrap animated">
  <nav class="site-state">
    {%- if config.archive_dir != '/' and site.posts.length > 0 %}
      <div class="site-state-item site-state-posts">
        {%- set archive_dir = theme.menu.archives.split('||')[0] | trim if theme.menu.archives else config.archive_dir + '/' %}
        <a href="{{ url_for(archive_dir) }}">
          <span class="site-state-item-count">{{ site.posts.length }}</span>
          <span class="site-state-item-name">{{ __('state.posts') }}</span>
        </a>
      </div>
    {%- endif %}

    {%- if site.categories.length > 0 %}
      {%- set categoriesPageQuery = site.pages.find({type: 'categories'}, {lean: true}) %}
      {%- set hasCategoriesPage = categoriesPageQuery.length > 0 %}
      <div class="site-state-item site-state-categories">
        {%- set category_dir = theme.menu.categories.split('||')[0] | trim if theme.menu.categories else config.category_dir + '/' %}
        {%- if hasCategoriesPage %}
          <a href="{{ url_for(category_dir) }}">
        {%- endif %}
        <span class="site-state-item-count">{{ site.categories.length }}</span>
        <span class="site-state-item-name">{{ __('state.categories') }}</span>
        {%- if hasCategoriesPage %}</a>{% endif %}
      </div>
    {%- endif %}

    {%- if site.tags.length > 0 %}
      {%- set tagsPageQuery = site.pages.find({type: 'tags'}, {lean: true}) %}
      {%- set hasTagsPage = tagsPageQuery.length > 0 %}
      <div class="site-state-item site-state-tags">
        {%- set tag_dir = theme.menu.tags.split('||')[0] | trim if theme.menu.tags else config.tag_dir + '/' %}
        {%- if hasTagsPage %}
          <a href="{{ url_for(tag_dir) }}">
        {%- endif %}
        <span class="site-state-item-count">{{ site.tags.length }}</span>
        <span class="site-state-item-name">{{ __('state.tags') }}</span>
        {%- if hasTagsPage %}</a>{% endif %}
      </div>
    {%- endif %}
  </nav>
</div>
{%- endif %}

{%- if theme.chat.enable and (theme.chatra.enable or theme.tidio.enable) %}
  <div class="sidebar-button animated">
    <button>
      {%- if theme.chat.icon %}<i class="{{ theme.chat.icon }}"></i>{% endif %}
      {{ __('widget.chat') }}
    </button>
  </div>
{%- endif %}

{%- if theme.social %}
  <div class="links-of-author animated">
    {%- for name, link in theme.social %}
      <span class="links-of-author-item">
        {%- set sidebarURL = link.split('||')[0] | trim %}
        {%- set sidebarIcon = '<i class="' + link.split('||')[1] | trim + ' fa-fw"></i>' if theme.social_icons.enable and link.split('||')[1] else '' %}
        {%- set sidebarText = '' if (theme.social_icons.enable and theme.social_icons.icons_only) else name %}
        {{ next_url(sidebarURL, sidebarIcon + sidebarText, {title: name + ' â†’ ' + sidebarURL, rel: 'noopener me'}) }}
      </span>
    {%- endfor %}
  </div>
{%- endif %}

{%- if theme.creative_commons.license and theme.creative_commons.sidebar %}
  <div class="cc-license animated" itemprop="license">
    {%- set ccImage = '<img src="' + theme.vendors.creative_commons.url + '" alt="Creative Commons">' %}
    {{ next_url(ccURL, ccImage, {class: 'cc-opacity'}) }}
  </div>
{%- endif %}

{%- if theme.popular_posts.enable %}
<style>
.popular-posts {
  margin-top: 20px;
  padding: 15px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.popular-posts .popular-posts-title {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 15px;
  font-size: 14px;
  font-weight: 600;
  color: #333;
}

.popular-posts .popular-posts-title i {
  font-size: 14px;
  color: #ff6b6b;
}

.popular-posts .popular-posts-list .popular-post-item {
  margin-bottom: 15px;
  padding-bottom: 12px;
  border-bottom: 1px solid #f0f0f0;
}

.popular-posts .popular-posts-list .popular-post-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
}

.popular-posts .popular-posts-list .popular-post-item .post-title {
  margin-bottom: 8px;
}

.popular-posts .popular-posts-list .popular-post-item .post-title a {
  font-size: 13px;
  line-height: 1.4;
  color: #333;
  text-decoration: none;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.popular-posts .popular-posts-list .popular-post-item .post-title a:hover {
  color: #ff6b6b;
}

.popular-posts .popular-posts-list .popular-post-item .post-excerpt {
  font-size: 11px;
  color: #666;
  line-height: 1.3;
  margin-bottom: 8px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.popular-posts .popular-posts-list .popular-post-item .post-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 10px;
  color: #999;
  line-height: 1;
}

.popular-posts .popular-posts-list .popular-post-item .post-meta .post-date {
  display: flex;
  align-items: center;
  gap: 3px;
}

.popular-posts .popular-posts-list .popular-post-item .post-meta .post-date i {
  font-size: 9px;
  color: #999;
}

.popular-posts .popular-posts-list .popular-post-item .post-meta .post-views {
  display: flex;
  align-items: center;
  gap: 3px;
}

.popular-posts .popular-posts-list .popular-post-item .post-meta .post-views i {
  font-size: 9px;
  color: #ff6b6b;
}

.popular-posts .popular-posts-list .popular-post-item .post-meta .post-views span {
  font-weight: normal;
  color: #999;
}
</style>

<div class="popular-posts">
  <div class="popular-posts-title">
    {%- if theme.popular_posts.icon %}
      <i class="{{ theme.popular_posts.icon }}"></i>
    {%- endif %}
    <span>{{ theme.popular_posts.title }}</span>
  </div>
  <div class="popular-posts-list" id="popular-posts-container">
    {%- set posts = get_popular_posts(site.posts) %}
    {%- for post in posts %}
    <div class="popular-post-item" data-post-path="{{ post.path }}" data-post-title="{{ post.title }}" data-post-date="{{ post.date if post.date else '' }}">
      <div class="post-title">
        <a href="{{ url_for(post.path) }}" title="{{ post.title }}">
          {{ post.title }}
        </a>
      </div>
      {%- if theme.popular_posts.display.includes('excerpt') %}
      <div class="post-excerpt">
        {{ post.excerpt or post.content | truncate(60) }}
      </div>
      {%- endif %}
      {%- if theme.popular_posts.display.includes('views') or theme.popular_posts.display.includes('date') %}
      <div class="post-meta">
        {%- if theme.popular_posts.display.includes('views') %}
        <div class="post-views">
          <i class="far fa-eye"></i>
          <span class="post-views-count" data-post-path="{{ post.path }}" data-post-views="{{ get_real_post_views(post) }}">
            <span id="busuanzi_value_page_pv_{{ post.path | replace('/', '_') | replace('.', '_') }}">{{ get_real_post_views(post) }}</span>
          </span>
        </div>
        {%- endif %}
        {%- if theme.popular_posts.display.includes('date') %}
        <div class="post-date">
          <i class="fa fa-calendar"></i>
          <script>
            document.write(new Date({{ post.date }}).toLocaleDateString('zh-CN', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit'
            }));
          </script>
        </div>
        {%- endif %}
      </div>
      {%- endif %}
    </div>
    {%- endfor %}
  </div>
</div>
{%- endif %}
